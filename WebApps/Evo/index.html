<!DOCTYPE html>
<html>
    <head>
        <title>Hungaroring genetic algorithm</title>
        <link rel="stylesheet" type="text/css" href="main.css"></link>
    </head>

    <body>

        <div class="headingBackground">
            <p class="text heading">Hungaroring racing</p>
        </div>
        
        <div class="flex-container main">
            <canvas id="drawCanvas" class="canvas" width="512" height="512" style="border:1px solid #d3d3d3;"> Your browser does not support the HTML5 canvas tag.</canvas>
            <div class="flex-container controls" width="512" height="200">
            </div>
        </div>

        <div class="controlpanel flex-container textctrl">
            <p>Simulation speed: <span id="simspeed">1</span>x</p>
            <input type="range" min="0" max="50" value="1" class="slider" id="simspeedinput" ><br>
            <input type="checkbox" id="checkDrawSensors" />Show car sensors
            <p id="results"> </p>
        </div>

        <div class="textblock">
            <p class="details" onclick="toggleDetails()" >Details</p>
            <div  id="expandable">
                <p class="textcontent">
                    This is a simulator where racing cars are learning how to drive on the roads of the Hungaroring race track using a genetic algorithm.
                    Each car has a neural network - a brain - that is initialized to a default random network with the following structure: 
                    <ul>
                        <li>Input layer of 9 neurons
                            <ul>
                                <li>Current speed and direction</li>
                                <li>Current gas/brake and steering wheel position</li>
                                <li>5 forward facing distance sensors that measure the distance between the car and the edge of the track in 5 directions.</li>
                            </ul>
                        </li>
                        <li>Hidden layer of 64 neurons</li>
                        <li>Output layer of 2 neurons
                            <ul>
                                <li>Gas/brake input</li>
                                <li>Steering wheel input</li>
                            </ul>
                        </li>
                    </ul>  
                    This neural network is driving each vehicle by choosing its speed and the direction.
                    In each generation 60 cars start racing. Cars get rewards for driven distance, and for passing checkpoints around the track.
                    At the end of a generation the best performing 12 cars will be selected for the next generation, and the remaining 48 places will be filled by their copies.
                    Before starting the new generation all 60 of the are mutated by applying a small random vector to their neural networks weights and biases.
                </p>
            </div>
        </div>

        <div id="loading" class="loadingbackground">
            <p class="loadingtext">Loading...</h2>
        </div>

        <img id="background" class="hide" src="hungaroring.png" />

        <script src="neuralnet.js"> </script>
        <script src="initialNetwork.js"> </script>
        <script src="entity.js"> </script>
        <script src="drawing.js"> </script>

        <script>
            document.getElementById("loading").hidden=true;
        </script>

        <script>
            var isDetailExpanded = false;
            var drawing = new EvoDrawing(document.getElementById("drawCanvas"), "background", "results");

            var checkboxSensors = document.getElementById("checkDrawSensors");
            checkboxSensors.onclick=function(){
                drawSensorsGlobal = checkboxSensors.checked;
            }

            var simSpeedSlider = document.getElementById("simspeedinput");
            var simSpeedElement = document.getElementById("simspeed");
            
            simSpeedElement.innerHTML = simSpeedSlider.value|0;
            drawing.SetSimulationSpeed(simSpeedSlider.value|0);
            
            simSpeedSlider.oninput = function() {
                simSpeedElement.innerHTML = this.value|0;
                drawing.SetSimulationSpeed(this.value|0);
            }

            function toggleDetails(){
                isDetailExpanded=!isDetailExpanded; 
                let expandable = document.getElementById('expandable');
                expandable.style.display = isDetailExpanded ? "block" : "none";
            }
        </script>


    </body>
</html>
